{"ast":null,"code":"// kanban-gui-test/src/components/Board.js\nimport React,{useState,useCallback,useRef,useEffect}from'react';// Lane is still imported, but its content is rendered inline for flexibility to manage layout\nimport Lane from'./Lane';import Card from'./Card';import FlyingCardAnimation from'./FlyingCardAnimation';//const API_BASE_URL = 'http://127.0.0.1:8000'; // Your FastAPI backend URL\n// IMPORTANT: Change this to the Ngrok URL copied from your Ngrok terminal in 'cd /opt/homebrew/bin/' --> ./ngrok http 8000\n//const API_BASE_URL = 'https://f1dcfea1a82a.ngrok-free.app'; // <<< REPLACE WITH YOUR NGROK URL <<<\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_BASE_URL='https://kanbanflow-web.onrender.com';const Board=()=>{const[lanes,setLanes]=useState([]);const[dashboardData,setDashboardData]=useState([]);// Default complexity for \"Schritt A/B/C\" columns (IDs 1, 3, 5)\nconst[complexity,setComplexity]=useState({1:1,3:1,5:1});const[wipLimit,setWipLimit]=useState(5);const[simSpeed,setSimSpeed]=useState(1.0);const[simulationRunning,setSimulationRunning]=useState(false);const flyingAnimations=useRef([]);// Manages active gliding animations\nconst cardRefs=useRef(new Map());// Stores DOM refs for cards\nconst laneRefs=useRef(new Map());// Stores DOM refs for lanes\nconst[isReady,setIsReady]=useState(false);// UI readiness flag\nuseEffect(()=>{const timeoutId=setTimeout(()=>{setIsReady(true);console.log('Board component and initial refs are likely ready.');},100);return()=>clearTimeout(timeoutId);},[]);// Helper to get a card by its ID from current React lanes state\nconst getCardById=useCallback(cardId=>{for(const lane of lanes){const card=lane.cards.find(c=>c.id===cardId);if(card)return card;}return null;},[lanes]);// Triggers the gliding animation for a specific card\nconst programmaticMoveCard=useCallback((cardId,targetLaneId)=>{const cardElement=cardRefs.current.get(cardId);const targetLaneElement=laneRefs.current.get(targetLaneId);if(!cardElement||!targetLaneElement){console.warn(`[Gliding Trace] Could not find element for card ${cardId} or lane ${targetLaneId}. Cannot animate.`);return;}const startRect=cardElement.getBoundingClientRect();const currentCardData=getCardById(cardId);if(!currentCardData){console.warn(`[Gliding Trace] Card ${cardId} not found in current state for animation.`);return;}console.log(`[Gliding Trace] Initiating animation for ${cardId}. Current flyingAnimations count: ${flyingAnimations.current.length}.`);// Add animation data immediately\nflyingAnimations.current.push({id:`flying-${cardId}-${Date.now()}`,// Unique ID for this animation instance\ncard:currentCardData,startRect:startRect,endRect:null// Will be updated via rAF\n});// Force React to re-render to pick up new items in flyingAnimations.current\nflyingAnimations.current=[...flyingAnimations.current];console.log(`[Gliding Trace] Added ${cardId}. New flyingAnimations count: ${flyingAnimations.current.length}. Array: `,flyingAnimations.current.map(a=>a.card.id));// Schedule getting endRect after React re-renders the actual card\nrequestAnimationFrame(()=>{flyingAnimations.current=flyingAnimations.current.map(anim=>{// Only process animations that have a startRect but no endRect yet AND match this card's ID\nif(anim.card.id===cardId&&anim.startRect&&anim.endRect===null){const newCardInDOM=cardRefs.current.get(anim.card.id);if(newCardInDOM){const endRect=newCardInDOM.getBoundingClientRect();return{...anim,endRect:endRect};}else{console.warn(`[Gliding-Fix] Card ${anim.card.id} not found in new DOM position for endRect. Cancelling animation clone.`);return null;// Mark for removal\n}}return anim;// Return other animations as is\n}).filter(Boolean);// Remove any null entries (cancelled animations)\nflyingAnimations.current=[...flyingAnimations.current];// Force re-render after updating endRects\nconsole.log(`[Gliding Trace] After rAF update. Current flyingAnimations count: ${flyingAnimations.current.length}. Array: `,flyingAnimations.current.map(a=>a.card.id));});},[getCardById]);// Callback from FlyingCardAnimation when an animation finishes\nconst handleAnimationEnd=useCallback(animatedCardId=>{console.log(`[Gliding Trace] Animation ended for card: ${animatedCardId}. Clearing animation entry.`);const initialCount=flyingAnimations.current.length;flyingAnimations.current=flyingAnimations.current.filter(anim=>anim.card.id!==animatedCardId);flyingAnimations.current=[...flyingAnimations.current];console.log(`[Gliding Trace] After filter for ${animatedCardId}. Count changed from ${initialCount} to ${flyingAnimations.current.length}. Array: `,flyingAnimations.current.map(a=>a.card.id));},[]);// --- API Call Functions ---\n// Sets simulation parameters on the backend\nconst setConfig=useCallback(async()=>{console.log(\"setConfig: Attempting to set simulation config...\");try{const response=await fetch(`${API_BASE_URL}/simulation/config`,{method:'POST',headers:{'Content-Type':'application/json','ngrok-skip-browser-warning':'true'},body:JSON.stringify({complexity,wip_limit:wipLimit,speed:simSpeed})});console.log(\"setConfig: Fetch request sent and response received.\");const data=await response.json();if(response.ok){console.log('setConfig: Config set successfully:',data);return true;// Indicate success\n}else{console.error('setConfig: Failed to set config (server responded with error):',data);return false;// Indicate failure\n}}catch(error){console.error('setConfig: Network error or problem sending request:',error);return false;// Indicate failure\n}},[complexity,wipLimit,simSpeed]);// Starts the simulation\nconst startSimulation=useCallback(async()=>{console.log(\"startSimulation: Attempting to start simulation...\");try{// Await setConfig and check its return value for success\nconst configSetSuccess=await setConfig();if(!configSetSuccess){console.warn(\"startSimulation: Configuration failed. Aborting simulation start.\");setSimulationRunning(false);// Ensure UI button state is correct\nreturn;// Exit if config failed\n}console.log(\"startSimulation: setConfig call finished and successful.\");// Now attempt to start the simulation itself\nconst response=await fetch(`${API_BASE_URL}/simulation/start`,{method:'POST',headers:{'ngrok-skip-browser-warning':'true'}});const data=await response.json();if(response.ok){console.log('startSimulation: Simulation started successfully:',data);setSimulationRunning(true);// Update state to running\n}else{console.error('startSimulation: Failed to start simulation (server responded with error):',data);// If the backend says it's already running, sync frontend state.\nif(data.detail&&data.detail==='Simulation is already running.'){console.log(\"startSimulation: Backend reported simulation already running. Syncing frontend state.\");setSimulationRunning(true);// Sync frontend state (button becomes disabled)\n}else{// General error\nsetSimulationRunning(false);// Ensure UI button state is correct\n}}}catch(error){console.error('startSimulation: Network error starting simulation or error from setConfig:',error);setSimulationRunning(false);// Assume failure, ensure UI button state is correct\n}},[setConfig]);// Dependency: setConfig must be robust\n// Stops the simulation\nconst stopSimulation=useCallback(async()=>{console.log(\"Stopping simulation...\");try{const response=await fetch(`${API_BASE_URL}/simulation/stop`,{method:'POST',headers:{'ngrok-skip-browser-warning':'true'}});const data=await response.json();if(response.ok){console.log('Simulation stopped:',data);setSimulationRunning(false);}else{console.error('Failed to stop simulation:',data);}}catch(error){console.error('Network error stopping simulation:',error);}},[]);// Clears dashboard data\nconst clearDashboard=useCallback(async()=>{console.log(\"Clearing dashboard...\");try{const response=await fetch(`${API_BASE_URL}/dashboard/clear`,{method:'POST',headers:{'ngrok-skip-browser-warning':'true'}});const data=await response.json();if(response.ok){console.log('Dashboard cleared:',data);setDashboardData([]);// Clear frontend dashboard data instantly\n}else{console.error('Failed to clear dashboard:',data);}}catch(error){console.error('Network error clearing dashboard:',error);}},[]);// --- Polling for Board State and Dashboard Data ---\n// Fetches simulation data periodically from backend\nuseEffect(()=>{let intervalId;const pollingInterval=1000;// Poll every 1 second\nconst fetchSimulationData=async()=>{// Fetch board state\ntry{const boardResponse=await fetch(`${API_BASE_URL}/simulation/status`,{headers:{'ngrok-skip-browser-warning':'true'}});const boardData=await boardResponse.json();if(boardResponse.ok){setSimulationRunning(boardData.is_running);// Sync running status from backend\nsetLanes(prevLanes=>{const newLanes=boardData.lanes;if(!prevLanes.length)return newLanes;// First load, no animation needed, just set initial state\nconst cardsToAnimateData=[];// Store data for cards that need gliding\n// Step 1: Create a quick lookup map for cards in the *previous* state\nconst oldCardsMap=new Map();prevLanes.forEach(lane=>{lane.cards.forEach(card=>{oldCardsMap.set(card.id,card);});});// Step 2: Iterate through cards in the *new* state to detect moves\nfor(const newLane of newLanes){for(const newCard of newLane.cards){const oldCard=oldCardsMap.get(newCard.id);// Condition for triggering a glide animation:\n// 1. The card existed in the previous state.\n// 2. Its current lane (newCard.col) is different from its previous lane (oldCard.col).\nif(oldCard&&oldCard.col!==newCard.col){const cardElement=cardRefs.current.get(oldCard.id);// Try to get the DOM element of the OLD card\n// Only attempt to animate if the old card's DOM element is *still present*\n// at its previous location when we poll.\nif(cardElement){cardsToAnimateData.push({card:oldCard,// Pass the OLD card data to the animation clone\nnewLaneId:newCard.col,// The new column ID is the target lane ID\nstartRect:cardElement.getBoundingClientRect()// Capture START position from the OLD element\n});}else{console.warn(`[Gliding-Fix] Old element for card ${oldCard.id} (from lane ${oldCard.col} to ${newCard.col}) not found for animation. Skipping glide.`);}}}}// Immediately push animation data to the ref, then force re-render\n// This ensures FlyingCardAnimation components are mounted quickly when original hides.\ncardsToAnimateData.forEach(animData=>{flyingAnimations.current.push({id:`flying-${animData.card.id}-${Date.now()}`,// Unique ID for this animation instance\ncard:animData.card,startRect:animData.startRect,endRect:null// Will be updated by requestAnimationFrame\n});});flyingAnimations.current=[...flyingAnimations.current];// Force re-render\n// Schedule endRect calculation after React updates DOM for newLanes\nrequestAnimationFrame(()=>{flyingAnimations.current=flyingAnimations.current.map(anim=>{// Only process animations that have a startRect but no endRect yet\nif(anim.startRect&&anim.endRect===null){const newCardInDOM=cardRefs.current.get(anim.card.id);if(newCardInDOM){const endRect=newCardInDOM.getBoundingClientRect();return{...anim,endRect:endRect};}else{console.warn(`[Gliding-Fix] Card ${anim.card.id} not found in new DOM position for endRect. Cancelling animation clone.`);return null;}}return anim;// Return already completed animations as is\n}).filter(Boolean);// Remove any null entries (cancelled animations)\nflyingAnimations.current=[...flyingAnimations.current];// Force re-render after updating endRects\n});return newLanes;// This updates the React `lanes` state with the new board data\n});}else{console.error('Failed to fetch board state:',boardData);setSimulationRunning(false);}}catch(error){console.error('Network error fetching board state:',error);setSimulationRunning(false);}// Fetch dashboard data\ntry{const dashboardResponse=await fetch(`${API_BASE_URL}/dashboard/data`,{headers:{'ngrok-skip-browser-warning':'true'}});const dashboardData=await dashboardResponse.json();if(dashboardResponse.ok){setDashboardData(dashboardData.dashboard_entries||[]);}else{console.error('Failed to fetch dashboard data:',dashboardData);}}catch(error){console.error('Network error fetching dashboard data:',error);}};fetchSimulationData();// Initial fetch on mount\nintervalId=setInterval(fetchSimulationData,pollingInterval);// Set up polling interval\nreturn()=>{clearInterval(intervalId);// Clear interval on component unmount\nconsole.log('Polling interval cleared.');};},[programmaticMoveCard]);// Re-run effect if programmaticMoveCard callback changes (unlikely)\n// Handler for individual complexity input changes\nconst handleComplexityChange=useCallback((colId,value)=>{setComplexity(prev=>({...prev,[colId]:parseInt(value)||0// Ensure it's an integer\n}));},[]);return(/*#__PURE__*/// Overall layout: flex column, centered, with padding\n// CHANGE: Reduced overall padding from p-4 to p-2 for a tighter fit\n_jsxs(\"div\",{className:\"flex flex-col p-2 bg-gray-50 min-h-screen items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-3 bg-white rounded-lg shadow-md w-full max-w-5xl flex flex-col sm:flex-row items-center justify-between gap-3 text-sm\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-gray-800 flex-shrink-0\",children:\"Verbessere die Durchlaufzeit der roten Karte durch WiP Limits!\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 flex-grow justify-center\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-xs font-bold mb-0\",children:\"Gesamt WIP Limit:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:wipLimit,onChange:e=>setWipLimit(parseInt(e.target.value)||0),className:\"shadow appearance-none border rounded w-20 py-0.5 px-1 text-gray-700 leading-tight focus:outline-none focus:shadow-outline text-xs\",min:\"0\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-xs font-bold mb-0\",children:\"Sim. Geschw. (s/Schritt):\"}),\" \",/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.1\",value:simSpeed//onChange={(e) => setSimSpeed(parseFloat(e.target.value) || 0.0)}\n,className:\"shadow appearance-none border rounded w-20 py-0.5 px-1 text-gray-700 leading-tight focus:outline-none focus:shadow-outline text-xs\",min:\"0.1\",disabled:true// CHANGE 3: Add the disabled attribute\n})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-center space-x-2 flex-shrink-0\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:startSimulation,disabled:!isReady||simulationRunning,className:`!w-16 py-1.5 rounded-lg text-white font-bold text-sm transition-colors duration-200 ${!isReady||simulationRunning?'bg-gray-400 cursor-not-allowed':'bg-green-500 hover:bg-green-700'}`,children:\"Start\"}),/*#__PURE__*/_jsx(\"button\",{onClick:clearDashboard,disabled:!isReady,className:`!w-16 py-1.5 rounded-lg text-white font-bold text-sm transition-colors duration-200 ${!isReady?'bg-gray-400 cursor-not-allowed':'bg-yellow-500 hover:bg-yellow-700'}`,children:\"L\\xF6schen\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex p-2 overflow-x-auto items-start bg-gray-100 rounded-lg shadow-inner w-full max-w-5xl\",children:[\" \",lanes.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"text-center text-gray-500 w-full p-10\",children:\"Keine Board-Daten verf\\xFCgbar. Simulation starten.\"}):lanes.map(lane=>/*#__PURE__*/_jsxs(\"div\",{ref:el=>{if(el)laneRefs.current.set(lane.id,el);else laneRefs.current.delete(lane.id);}// Column base styling: fixed width, flex column for header/cards stacking\n,className:\"flex-shrink-0 mr-1 bg-gray-200 rounded-lg shadow-inner flex flex-col items-center\",style:{width:'122px',minHeight:'500px'},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-1.5 bg-gray-300 rounded-t-lg text-center w-full border-b border-gray-400\",style:{minHeight:'70px'},children:[\" \",/*#__PURE__*/_jsx(\"h2\",{className:\"text-sm font-semibold text-gray-800 pb-0.5\",children:lane.title}),lane.max_wip_in_round!==undefined&&/*#__PURE__*/_jsxs(\"span\",{className:\"text-xs text-gray-600 block\",children:[\"Max WIP: \",lane.max_wip_in_round]}),(lane.id==='lane-1'||lane.id==='lane-3'||lane.id==='lane-5')&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-1 flex items-center justify-center gap-1\",children:[\" \",/*#__PURE__*/_jsx(\"label\",{className:\"text-gray-700 text-xs font-bold\",children:\"K'xit\\xE4t:\"}),\" \",/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:complexity[parseInt(lane.id.split('-')[1])]||1,onChange:e=>handleComplexityChange(parseInt(lane.id.split('-')[1]),e.target.value),className:\"shadow appearance-none border rounded w-10 py-0 px-0.5 text-gray-700 leading-tight focus:outline-none focus:shadow-outline text-xs text-center\",min:\"1\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center w-full mt-1 overflow-y-auto\",style:{maxHeight:'calc(100% - 70px)'},children:[\" \",lane.cards.map((card,index)=>{const isFlyingClone=flyingAnimations.current.some(anim=>anim.card.id===card.id);return/*#__PURE__*/_jsx(Card,{id:card.id,text:card.birth_id?`Karte ${card.birth_id}`:card.id,laneId:card.col,index:index,ref:el=>{if(el)cardRefs.current.set(card.id,el);else cardRefs.current.delete(card.id);},style:{visibility:isFlyingClone?'hidden':'visible',backgroundColor:card.is_red?'#ca0633':'#ffffff',width:'90px',height:'30px',padding:'4px 6px',fontSize:'0.75rem',textAlign:'center',display:'flex',justifyContent:'center',alignItems:'center',marginBottom:'4px',whiteSpace:'nowrap',// NEW: Prevent text from wrapping\noverflow:'hidden',// NEW: Hide text that overflows\ntextOverflow:'ellipsis'// NEW: Add \"...\" for hidden text (optional, but good UX)\n}},card.id);})]})]},lane.id))]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-2 bg-white rounded-lg shadow-md w-full max-w-5xl text-sm\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-gray-800 mb-2 border-b pb-1\",children:\"Dashboard\"}),dashboardData.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 text-xs p-1\",children:\"Dashboard ist leer. Simulation starten.\"}):/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-1 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Runde\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-1 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"WiP Limit\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-1 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Durchlaufzeit (Rot)\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-1 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Flusseff.\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-1 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"in Arbeit\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-1 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Erledigt\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-1 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Durchsatz\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:dashboardData.slice().reverse().map((entry,index)=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-1 py-1 whitespace-nowrap text-xs text-gray-900\",children:entry.round}),/*#__PURE__*/_jsx(\"td\",{className:\"px-1 py-1 whitespace-nowrap text-xs text-gray-900\",children:entry.wip_limit}),/*#__PURE__*/_jsx(\"td\",{className:\"px-1 py-1 whitespace-nowrap text-xs text-gray-900\",children:entry.red_card_cycle_time}),/*#__PURE__*/_jsx(\"td\",{className:\"px-1 py-1 whitespace-nowrap text-xs text-gray-900\",children:entry.flow_efficiency}),/*#__PURE__*/_jsx(\"td\",{className:\"px-1 py-1 whitespace-nowrap text-xs text-gray-900\",children:entry.in_progress}),/*#__PURE__*/_jsx(\"td\",{className:\"px-1 py-1 whitespace-nowrap text-xs text-gray-900\",children:entry.done}),/*#__PURE__*/_jsx(\"td\",{className:\"px-1 py-1 whitespace-nowrap text-xs text-gray-900\",children:entry.throughput})]},index))})]})})]}),flyingAnimations.current.map(anim=>anim.startRect&&/*#__PURE__*/_jsx(FlyingCardAnimation,{card:anim.card,startRect:anim.startRect,endRect:anim.endRect,onAnimationEnd:handleAnimationEnd},anim.id))]}));};export default Board;","map":{"version":3,"names":["React","useState","useCallback","useRef","useEffect","Lane","Card","FlyingCardAnimation","jsx","_jsx","jsxs","_jsxs","API_BASE_URL","Board","lanes","setLanes","dashboardData","setDashboardData","complexity","setComplexity","wipLimit","setWipLimit","simSpeed","setSimSpeed","simulationRunning","setSimulationRunning","flyingAnimations","cardRefs","Map","laneRefs","isReady","setIsReady","timeoutId","setTimeout","console","log","clearTimeout","getCardById","cardId","lane","card","cards","find","c","id","programmaticMoveCard","targetLaneId","cardElement","current","get","targetLaneElement","warn","startRect","getBoundingClientRect","currentCardData","length","push","Date","now","endRect","map","a","requestAnimationFrame","anim","newCardInDOM","filter","Boolean","handleAnimationEnd","animatedCardId","initialCount","setConfig","response","fetch","method","headers","body","JSON","stringify","wip_limit","speed","data","json","ok","error","startSimulation","configSetSuccess","detail","stopSimulation","clearDashboard","intervalId","pollingInterval","fetchSimulationData","boardResponse","boardData","is_running","prevLanes","newLanes","cardsToAnimateData","oldCardsMap","forEach","set","newLane","newCard","oldCard","col","newLaneId","animData","dashboardResponse","dashboard_entries","setInterval","clearInterval","handleComplexityChange","colId","value","prev","parseInt","className","children","type","onChange","e","target","min","step","disabled","onClick","ref","el","delete","style","width","minHeight","title","max_wip_in_round","undefined","split","maxHeight","index","isFlyingClone","some","text","birth_id","laneId","visibility","backgroundColor","is_red","height","padding","fontSize","textAlign","display","justifyContent","alignItems","marginBottom","whiteSpace","overflow","textOverflow","slice","reverse","entry","round","red_card_cycle_time","flow_efficiency","in_progress","done","throughput","onAnimationEnd"],"sources":["/Users/ralf/PyPrograms/KanbanFlow-Web/kanban-gui-test/src/components/Board.js"],"sourcesContent":["// kanban-gui-test/src/components/Board.js\n\nimport React, { useState, useCallback, useRef, useEffect } from 'react';\n// Lane is still imported, but its content is rendered inline for flexibility to manage layout\nimport Lane from './Lane';\nimport Card from './Card';\nimport FlyingCardAnimation from './FlyingCardAnimation';\n\n//const API_BASE_URL = 'http://127.0.0.1:8000'; // Your FastAPI backend URL\n// IMPORTANT: Change this to the Ngrok URL copied from your Ngrok terminal in 'cd /opt/homebrew/bin/' --> ./ngrok http 8000\n//const API_BASE_URL = 'https://f1dcfea1a82a.ngrok-free.app'; // <<< REPLACE WITH YOUR NGROK URL <<<\nconst API_BASE_URL = 'https://kanbanflow-web.onrender.com';\n\nconst Board = () => {\n  const [lanes, setLanes] = useState([]);\n  const [dashboardData, setDashboardData] = useState([]);\n\n  // Default complexity for \"Schritt A/B/C\" columns (IDs 1, 3, 5)\n  const [complexity, setComplexity] = useState({ 1: 1, 3: 1, 5: 1 });\n  const [wipLimit, setWipLimit] = useState(5);\n  const [simSpeed, setSimSpeed] = useState(1.0);\n\n  const [simulationRunning, setSimulationRunning] = useState(false);\n\n  const flyingAnimations = useRef([]); // Manages active gliding animations\n  const cardRefs = useRef(new Map()); // Stores DOM refs for cards\n  const laneRefs = useRef(new Map()); // Stores DOM refs for lanes\n\n  const [isReady, setIsReady] = useState(false); // UI readiness flag\n  useEffect(() => {\n    const timeoutId = setTimeout(() => {\n      setIsReady(true);\n      console.log('Board component and initial refs are likely ready.');\n    }, 100);\n    return () => clearTimeout(timeoutId);\n  }, []);\n\n  // Helper to get a card by its ID from current React lanes state\n  const getCardById = useCallback((cardId) => {\n    for (const lane of lanes) {\n      const card = lane.cards.find(c => c.id === cardId);\n      if (card) return card;\n    }\n    return null;\n  }, [lanes]);\n\n  // Triggers the gliding animation for a specific card\n  const programmaticMoveCard = useCallback((cardId, targetLaneId) => {\n    const cardElement = cardRefs.current.get(cardId);\n    const targetLaneElement = laneRefs.current.get(targetLaneId);\n\n    if (!cardElement || !targetLaneElement) {\n      console.warn(`[Gliding Trace] Could not find element for card ${cardId} or lane ${targetLaneId}. Cannot animate.`);\n      return;\n    }\n\n    const startRect = cardElement.getBoundingClientRect();\n    const currentCardData = getCardById(cardId);\n\n    if (!currentCardData) {\n        console.warn(`[Gliding Trace] Card ${cardId} not found in current state for animation.`);\n        return;\n    }\n\n    console.log(`[Gliding Trace] Initiating animation for ${cardId}. Current flyingAnimations count: ${flyingAnimations.current.length}.`);\n\n    // Add animation data immediately\n    flyingAnimations.current.push({\n        id: `flying-${cardId}-${Date.now()}`, // Unique ID for this animation instance\n        card: currentCardData,\n        startRect: startRect,\n        endRect: null // Will be updated via rAF\n    });\n    // Force React to re-render to pick up new items in flyingAnimations.current\n    flyingAnimations.current = [...flyingAnimations.current]; \n    console.log(`[Gliding Trace] Added ${cardId}. New flyingAnimations count: ${flyingAnimations.current.length}. Array: `, flyingAnimations.current.map(a => a.card.id));\n\n\n    // Schedule getting endRect after React re-renders the actual card\n    requestAnimationFrame(() => {\n        flyingAnimations.current = flyingAnimations.current.map(anim => {\n            // Only process animations that have a startRect but no endRect yet AND match this card's ID\n            if (anim.card.id === cardId && anim.startRect && anim.endRect === null) {\n                const newCardInDOM = cardRefs.current.get(anim.card.id);\n                if (newCardInDOM) {\n                    const endRect = newCardInDOM.getBoundingClientRect();\n                    return { ...anim, endRect: endRect };\n                } else {\n                    console.warn(`[Gliding-Fix] Card ${anim.card.id} not found in new DOM position for endRect. Cancelling animation clone.`);\n                    return null; // Mark for removal\n                }\n            }\n            return anim; // Return other animations as is\n        }).filter(Boolean); // Remove any null entries (cancelled animations)\n        flyingAnimations.current = [...flyingAnimations.current]; // Force re-render after updating endRects\n        console.log(`[Gliding Trace] After rAF update. Current flyingAnimations count: ${flyingAnimations.current.length}. Array: `, flyingAnimations.current.map(a => a.card.id));\n    });\n\n  }, [getCardById]);\n\n  // Callback from FlyingCardAnimation when an animation finishes\n  const handleAnimationEnd = useCallback((animatedCardId) => {\n    console.log(`[Gliding Trace] Animation ended for card: ${animatedCardId}. Clearing animation entry.`);\n    const initialCount = flyingAnimations.current.length;\n    flyingAnimations.current = flyingAnimations.current.filter(anim => anim.card.id !== animatedCardId);\n    flyingAnimations.current = [...flyingAnimations.current];\n    console.log(`[Gliding Trace] After filter for ${animatedCardId}. Count changed from ${initialCount} to ${flyingAnimations.current.length}. Array: `, flyingAnimations.current.map(a => a.card.id));\n  }, []);\n\n  // --- API Call Functions ---\n  // Sets simulation parameters on the backend\n  const setConfig = useCallback(async () => {\n    console.log(\"setConfig: Attempting to set simulation config...\");\n    try {\n      const response = await fetch(`${API_BASE_URL}/simulation/config`, {\n        method: 'POST',\n        headers: { \n          'Content-Type': 'application/json',\n          'ngrok-skip-browser-warning': 'true'\n        },\n        body: JSON.stringify({ complexity, wip_limit: wipLimit, speed: simSpeed }),\n      });\n      console.log(\"setConfig: Fetch request sent and response received.\");\n      const data = await response.json();\n      if (response.ok) {\n        console.log('setConfig: Config set successfully:', data);\n        return true; // Indicate success\n      } else {\n        console.error('setConfig: Failed to set config (server responded with error):', data);\n        return false; // Indicate failure\n      }\n    } catch (error) {\n      console.error('setConfig: Network error or problem sending request:', error);\n      return false; // Indicate failure\n    }\n  }, [complexity, wipLimit, simSpeed]);\n\n  // Starts the simulation\n  const startSimulation = useCallback(async () => {\n    console.log(\"startSimulation: Attempting to start simulation...\");\n    try {\n      // Await setConfig and check its return value for success\n      const configSetSuccess = await setConfig();\n      if (!configSetSuccess) {\n        console.warn(\"startSimulation: Configuration failed. Aborting simulation start.\");\n        setSimulationRunning(false); // Ensure UI button state is correct\n        return; // Exit if config failed\n      }\n      console.log(\"startSimulation: setConfig call finished and successful.\");\n\n      // Now attempt to start the simulation itself\n      const response = await fetch(`${API_BASE_URL}/simulation/start`, {\n        method: 'POST',\n        headers: { 'ngrok-skip-browser-warning': 'true' }\n      });\n      const data = await response.json();\n      if (response.ok) {\n        console.log('startSimulation: Simulation started successfully:', data);\n        setSimulationRunning(true); // Update state to running\n      } else {\n        console.error('startSimulation: Failed to start simulation (server responded with error):', data);\n        // If the backend says it's already running, sync frontend state.\n        if (data.detail && data.detail === 'Simulation is already running.') {\n            console.log(\"startSimulation: Backend reported simulation already running. Syncing frontend state.\");\n            setSimulationRunning(true); // Sync frontend state (button becomes disabled)\n        } else {\n            // General error\n            setSimulationRunning(false); // Ensure UI button state is correct\n        }\n      }\n    } catch (error) {\n      console.error('startSimulation: Network error starting simulation or error from setConfig:', error);\n      setSimulationRunning(false); // Assume failure, ensure UI button state is correct\n    }\n  }, [setConfig]); // Dependency: setConfig must be robust\n\n  // Stops the simulation\n  const stopSimulation = useCallback(async () => {\n    console.log(\"Stopping simulation...\");\n    try {\n      const response = await fetch(`${API_BASE_URL}/simulation/stop`, {\n        method: 'POST',\n        headers: { 'ngrok-skip-browser-warning': 'true' }\n      });\n      const data = await response.json();\n      if (response.ok) {\n        console.log('Simulation stopped:', data);\n        setSimulationRunning(false);\n      } else {\n        console.error('Failed to stop simulation:', data);\n      }\n    } catch (error) {\n      console.error('Network error stopping simulation:', error);\n    }\n  }, []);\n\n  // Clears dashboard data\n  const clearDashboard = useCallback(async () => {\n    console.log(\"Clearing dashboard...\");\n    try {\n      const response = await fetch(`${API_BASE_URL}/dashboard/clear`, {\n        method: 'POST',\n        headers: { 'ngrok-skip-browser-warning': 'true' }\n      });\n      const data = await response.json();\n      if (response.ok) {\n        console.log('Dashboard cleared:', data);\n        setDashboardData([]); // Clear frontend dashboard data instantly\n      } else {\n        console.error('Failed to clear dashboard:', data);\n      }\n    } catch (error) {\n      console.error('Network error clearing dashboard:', error);\n    }\n  }, []);\n\n  // --- Polling for Board State and Dashboard Data ---\n  // Fetches simulation data periodically from backend\n  useEffect(() => {\n    let intervalId;\n    const pollingInterval = 1000; // Poll every 1 second\n\n    const fetchSimulationData = async () => {\n      // Fetch board state\n      try {\n        const boardResponse = await fetch(`${API_BASE_URL}/simulation/status`, {\n          headers: { 'ngrok-skip-browser-warning': 'true' }\n        });\n          \n        const boardData = await boardResponse.json();\n        if (boardResponse.ok) {\n          setSimulationRunning(boardData.is_running); // Sync running status from backend\n\n          setLanes(prevLanes => {\n            const newLanes = boardData.lanes;\n            if (!prevLanes.length) return newLanes; // First load, no animation needed, just set initial state\n\n            const cardsToAnimateData = []; // Store data for cards that need gliding\n\n            // Step 1: Create a quick lookup map for cards in the *previous* state\n            const oldCardsMap = new Map();\n            prevLanes.forEach(lane => {\n                lane.cards.forEach(card => {\n                    oldCardsMap.set(card.id, card);\n                });\n            });\n\n            // Step 2: Iterate through cards in the *new* state to detect moves\n            for (const newLane of newLanes) {\n                for (const newCard of newLane.cards) {\n                    const oldCard = oldCardsMap.get(newCard.id);\n\n                    // Condition for triggering a glide animation:\n                    // 1. The card existed in the previous state.\n                    // 2. Its current lane (newCard.col) is different from its previous lane (oldCard.col).\n                    if (oldCard && oldCard.col !== newCard.col) {\n                        const cardElement = cardRefs.current.get(oldCard.id); // Try to get the DOM element of the OLD card\n\n                        // Only attempt to animate if the old card's DOM element is *still present*\n                        // at its previous location when we poll.\n                        if (cardElement) {\n                            cardsToAnimateData.push({\n                                card: oldCard, // Pass the OLD card data to the animation clone\n                                newLaneId: newCard.col, // The new column ID is the target lane ID\n                                startRect: cardElement.getBoundingClientRect() // Capture START position from the OLD element\n                            });\n                        } else {\n                            console.warn(`[Gliding-Fix] Old element for card ${oldCard.id} (from lane ${oldCard.col} to ${newCard.col}) not found for animation. Skipping glide.`);\n                        }\n                    }\n                }\n            }\n\n            // Immediately push animation data to the ref, then force re-render\n            // This ensures FlyingCardAnimation components are mounted quickly when original hides.\n            cardsToAnimateData.forEach(animData => {\n                flyingAnimations.current.push({\n                    id: `flying-${animData.card.id}-${Date.now()}`, // Unique ID for this animation instance\n                    card: animData.card,\n                    startRect: animData.startRect,\n                    endRect: null // Will be updated by requestAnimationFrame\n                });\n            });\n            flyingAnimations.current = [...flyingAnimations.current]; // Force re-render\n\n            // Schedule endRect calculation after React updates DOM for newLanes\n            requestAnimationFrame(() => {\n                flyingAnimations.current = flyingAnimations.current.map(anim => {\n                    // Only process animations that have a startRect but no endRect yet\n                    if (anim.startRect && anim.endRect === null) {\n                        const newCardInDOM = cardRefs.current.get(anim.card.id);\n                        if (newCardInDOM) {\n                            const endRect = newCardInDOM.getBoundingClientRect();\n                            return { ...anim, endRect: endRect };\n                        } else {\n                            console.warn(`[Gliding-Fix] Card ${anim.card.id} not found in new DOM position for endRect. Cancelling animation clone.`);\n                            return null;\n                        }\n                    }\n                    return anim; // Return already completed animations as is\n                }).filter(Boolean); // Remove any null entries (cancelled animations)\n                flyingAnimations.current = [...flyingAnimations.current]; // Force re-render after updating endRects\n            });\n\n            return newLanes; // This updates the React `lanes` state with the new board data\n          });\n\n        } else {\n          console.error('Failed to fetch board state:', boardData);\n          setSimulationRunning(false);\n        }\n      } catch (error) {\n        console.error('Network error fetching board state:', error);\n        setSimulationRunning(false);\n      }\n\n      // Fetch dashboard data\n      try {\n        const dashboardResponse = await fetch(`${API_BASE_URL}/dashboard/data`, {\n          headers: { 'ngrok-skip-browser-warning': 'true' }\n        });\n        const dashboardData = await dashboardResponse.json();\n        if (dashboardResponse.ok) {\n          setDashboardData(dashboardData.dashboard_entries || []);\n        } else {\n          console.error('Failed to fetch dashboard data:', dashboardData);\n        }\n      } catch (error) {\n        console.error('Network error fetching dashboard data:', error);\n      }\n    };\n\n    fetchSimulationData(); // Initial fetch on mount\n    intervalId = setInterval(fetchSimulationData, pollingInterval); // Set up polling interval\n    return () => {\n      clearInterval(intervalId); // Clear interval on component unmount\n      console.log('Polling interval cleared.');\n    };\n  }, [programmaticMoveCard]); // Re-run effect if programmaticMoveCard callback changes (unlikely)\n\n  // Handler for individual complexity input changes\n  const handleComplexityChange = useCallback((colId, value) => {\n    setComplexity(prev => ({\n      ...prev,\n      [colId]: parseInt(value) || 0 // Ensure it's an integer\n    }));\n  }, []);\n\n\n  return (\n    // Overall layout: flex column, centered, with padding\n     // CHANGE: Reduced overall padding from p-4 to p-2 for a tighter fit\n      <div className=\"flex flex-col p-2 bg-gray-50 min-h-screen items-center\">\n        {/* Simulation Controls (More Compact and Styled) */}\n        {/* CHANGE: Removed mb-4 to bring it closer to the board */}\n        <div className=\"p-3 bg-white rounded-lg shadow-md w-full max-w-5xl flex flex-col sm:flex-row items-center justify-between gap-3 text-sm\">\n          <h3 className=\"text-xl font-bold text-gray-800 flex-shrink-0\">Verbessere die Durchlaufzeit der roten Karte durch WiP Limits!</h3>\n        \n        {/* Global Parameters */}\n        <div className=\"flex items-center gap-3 flex-grow justify-center\">\n            <div>\n              <label className=\"block text-gray-700 text-xs font-bold mb-0\">Gesamt WIP Limit:</label>\n              <input\n                type=\"number\"\n                value={wipLimit}\n                onChange={(e) => setWipLimit(parseInt(e.target.value) || 0)}\n                className=\"shadow appearance-none border rounded w-20 py-0.5 px-1 text-gray-700 leading-tight focus:outline-none focus:shadow-outline text-xs\"\n                min=\"0\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-gray-700 text-xs font-bold mb-0\">Sim. Geschw. (s/Schritt):</label> {/* Shorter label */}\n              <input\n                type=\"number\"\n                step=\"0.1\"\n                value={simSpeed}\n                //onChange={(e) => setSimSpeed(parseFloat(e.target.value) || 0.0)}\n                className=\"shadow appearance-none border rounded w-20 py-0.5 px-1 text-gray-700 leading-tight focus:outline-none focus:shadow-outline text-xs\"\n                min=\"0.1\"\n                disabled // CHANGE 3: Add the disabled attribute\n              />\n            </div>\n        </div>\n\n        {/* Action Buttons */}\n        <div className=\"flex justify-center space-x-2 flex-shrink-0\">\n          <button\n            onClick={startSimulation}\n            disabled={!isReady || simulationRunning}\n            className={`!w-16 py-1.5 rounded-lg text-white font-bold text-sm transition-colors duration-200 ${\n              !isReady || simulationRunning ? 'bg-gray-400 cursor-not-allowed' : 'bg-green-500 hover:bg-green-700'\n            }`}\n          >\n            Start\n          </button>\n\n           <button\n            onClick={clearDashboard}\n            disabled={!isReady}\n            className={`!w-16 py-1.5 rounded-lg text-white font-bold text-sm transition-colors duration-200 ${\n              !isReady ? 'bg-gray-400 cursor-not-allowed' : 'bg-yellow-500 hover:bg-yellow-700'\n            }`}\n          >\n            Löschen\n          </button> \n        </div>\n      </div>\n\n      {/* Kanban Board Display */}\n      {/* Reduced padding, margin-right, and added fixed width for columns */}\n     <div className=\"flex p-2 overflow-x-auto items-start bg-gray-100 rounded-lg shadow-inner w-full max-w-5xl\"> {/* REMOVED flex-grow */}\n        {lanes.length === 0 ? (\n          <p className=\"text-center text-gray-500 w-full p-10\">\n            Keine Board-Daten verfügbar. Simulation starten.\n          </p>\n        ) : (\n          lanes.map((lane) => (\n            <div\n              key={lane.id}\n              ref={el => {\n                if (el) laneRefs.current.set(lane.id, el);\n                else laneRefs.current.delete(lane.id);\n              }}\n              // Column base styling: fixed width, flex column for header/cards stacking\n              className=\"flex-shrink-0 mr-1 bg-gray-200 rounded-lg shadow-inner flex flex-col items-center\"\n              style={{ width: '122px', minHeight: '500px' }}\n            >\n              {/* NEW: Column Header Section */}\n              <div className=\"p-1.5 bg-gray-300 rounded-t-lg text-center w-full border-b border-gray-400\" style={{ minHeight: '70px' }}> {/* NEW: minHeight for consistent header height */}\n                <h2 className=\"text-sm font-semibold text-gray-800 pb-0.5\">\n                  {lane.title}\n                </h2>\n                {/* Max WIP display for ALL columns */}\n                {lane.max_wip_in_round !== undefined && (\n                    <span className=\"text-xs text-gray-600 block\">Max WIP: {lane.max_wip_in_round}</span>\n                )}\n                {/* Complexity input for \"Schritt A/B/C\" columns (IDs 1, 3, 5) */}\n                {(lane.id === 'lane-1' || lane.id === 'lane-3' || lane.id === 'lane-5') && (\n                    <div className=\"mt-1 flex items-center justify-center gap-1\"> {/* Inline Komplexität */}\n                        <label className=\"text-gray-700 text-xs font-bold\">K'xität:</label> {/* Shorter label */}\n                        <input\n                            type=\"number\"\n                            value={complexity[parseInt(lane.id.split('-')[1])] || 1}\n                            onChange={(e) => handleComplexityChange(parseInt(lane.id.split('-')[1]), e.target.value)}\n                            className=\"shadow appearance-none border rounded w-10 py-0 px-0.5 text-gray-700 leading-tight focus:outline-none focus:shadow-outline text-xs text-center\"\n                            min=\"1\"\n                        />\n                    </div>\n                )}\n              </div>\n\n              {/* NEW: Card Area (underneath header) */}\n              <div className=\"flex flex-col items-center w-full mt-1 overflow-y-auto\" style={{ maxHeight: 'calc(100% - 70px)' }}> {/* Adjust height to account for header's fixed height */}\n                {lane.cards.map((card, index) => {\n                  const isFlyingClone = flyingAnimations.current.some(anim => anim.card.id === card.id);\n                  return (\n                    <Card\n                      key={card.id}\n                      id={card.id}\n                      text={card.birth_id ? `Karte ${card.birth_id}` : card.id}\n                      laneId={card.col}\n                      index={index}\n                      ref={el => {\n                        if (el) cardRefs.current.set(card.id, el);\n                        else cardRefs.current.delete(card.id);\n                      }}\n                      style={{\n                        visibility: isFlyingClone ? 'hidden' : 'visible',\n                        backgroundColor: card.is_red ? '#ca0633' : '#ffffff',\n                        width: '90px',\n                        height: '30px',\n                        padding: '4px 6px',\n                        fontSize: '0.75rem',\n                        textAlign: 'center',\n                        display: 'flex',\n                        justifyContent: 'center',\n                        alignItems: 'center',\n                        marginBottom: '4px',\n                        whiteSpace: 'nowrap',   // NEW: Prevent text from wrapping\n                        overflow: 'hidden',      // NEW: Hide text that overflows\n                        textOverflow: 'ellipsis' // NEW: Add \"...\" for hidden text (optional, but good UX)\n               \n                      }}\n                    />\n                  );\n                })}\n              </div>\n            </div>\n          ))\n        )}\n      </div>\n\n      {/* Dashboard Table (More Compact) */}\n      <div className=\"p-2 bg-white rounded-lg shadow-md w-full max-w-5xl text-sm\">\n        <h3 className=\"text-xl font-bold text-gray-800 mb-2 border-b pb-1\">Dashboard</h3>\n        {dashboardData.length === 0 ? (\n          <p className=\"text-gray-500 text-xs p-1\">Dashboard ist leer. Simulation starten.</p>\n        ) : (\n          <div className=\"overflow-x-auto\">\n            <table className=\"min-w-full divide-y divide-gray-200\">\n              <thead className=\"bg-gray-50\">\n                <tr>\n                  <th className=\"px-1 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Runde</th>\n                  <th className=\"px-1 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">WiP Limit</th>\n                  <th className=\"px-1 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Durchlaufzeit (Rot)</th>\n                  <th className=\"px-1 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Flusseff.</th>\n                  <th className=\"px-1 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">in Arbeit</th>\n                  <th className=\"px-1 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Erledigt</th>\n                  <th className=\"px-1 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Durchsatz</th>\n                </tr>\n              </thead>\n              <tbody className=\"bg-white divide-y divide-gray-200\">\n                {dashboardData.slice().reverse().map((entry, index) => (\n                  <tr key={index}>\n                    <td className=\"px-1 py-1 whitespace-nowrap text-xs text-gray-900\">{entry.round}</td>\n                    <td className=\"px-1 py-1 whitespace-nowrap text-xs text-gray-900\">{entry.wip_limit}</td>\n                    <td className=\"px-1 py-1 whitespace-nowrap text-xs text-gray-900\">{entry.red_card_cycle_time}</td>\n                    <td className=\"px-1 py-1 whitespace-nowrap text-xs text-gray-900\">{entry.flow_efficiency}</td>\n                    <td className=\"px-1 py-1 whitespace-nowrap text-xs text-gray-900\">{entry.in_progress}</td>\n                    <td className=\"px-1 py-1 whitespace-nowrap text-xs text-gray-900\">{entry.done}</td>\n                    <td className=\"px-1 py-1 whitespace-nowrap text-xs text-gray-900\">{entry.throughput}</td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n        )}\n      </div>\n\n      {/* Render flying animations on top of everything */}\n      {flyingAnimations.current.map(anim => anim.startRect && (\n        <FlyingCardAnimation\n          key={anim.id}\n          card={anim.card}\n          startRect={anim.startRect}\n          endRect={anim.endRect}\n          onAnimationEnd={handleAnimationEnd}\n        />\n      ))}\n    </div>\n  );\n};\n\nexport default Board;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}